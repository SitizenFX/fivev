--- a/net/minecraft/client/Options.java
+++ b/net/minecraft/client/Options.java
@@ -709,7 +_,8 @@
         },
         new OptionInstance.LazyEnum<>(
             () -> Stream.concat(Stream.of(""), Minecraft.getInstance().getSoundManager().getAvailableSoundDevices().stream()).toList(),
-            p_232011_ -> Minecraft.getInstance().isRunning() && p_232011_ != "" && !Minecraft.getInstance().getSoundManager().getAvailableSoundDevices().contains(p_232011_)
+            // FORGE: fix incorrect string comparison - PR #8767
+            p_232011_ -> Minecraft.getInstance().isRunning() && (p_232011_ == null || !p_232011_.isEmpty()) && !Minecraft.getInstance().getSoundManager().getAvailableSoundDevices().contains(p_232011_)
                 ? Optional.empty()
                 : Optional.of(p_232011_),
             Codec.STRING
@@ -743,6 +_,7 @@
     );
     public boolean syncWrites;
     public boolean startedCleanly = true;
+    private final Map<String, String> unknownKeys = new java.util.HashMap<>();
 
     public OptionInstance<Boolean> darkMojangStudiosBackground() {
         return this.darkMojangStudiosBackground;
@@ -1150,6 +_,7 @@
     }
 
     public Options(Minecraft p_92138_, File p_92139_) {
+        setForgeKeybindProperties();
         this.minecraft = p_92138_;
         this.optionsFile = new File(p_92139_, "options.txt");
         boolean flag = Runtime.getRuntime().maxMemory() >= 1000000000L;
@@ -1290,15 +_,28 @@
         this.startedCleanly = p_168428_.process("startedCleanly", this.startedCleanly);
         p_168428_.process("showNowPlayingToast", this.showNowPlayingToast);
         p_168428_.process("musicFrequency", this.musicFrequency);
+        processOptionsKeysOnly(p_168428_);
+        processOptionsEnd(p_168428_);
+    }
 
+    // FORGE: split off to allow reloading keys after mod loading is done
+    private void processOptionsKeysOnly(Options.FieldAccess p_168428_) {
         for (KeyMapping keymapping : this.keyMappings) {
-            String s = keymapping.saveString();
+            String s = keymapping.saveString() + (keymapping.getKeyModifier() != net.minecraftforge.client.settings.KeyModifier.NONE ? ":" + keymapping.getKeyModifier() : "");
             String s1 = p_168428_.process("key_" + keymapping.getName(), s);
             if (!s.equals(s1)) {
                 keymapping.setKey(InputConstants.getKey(s1));
+                if (s1.indexOf(':') != -1) {
+                    String[] pts = s1.split(":");
+                    keymapping.setKeyModifierAndCode(net.minecraftforge.client.settings.KeyModifier.valueFromString(pts[1]), InputConstants.getKey(pts[0]));
+                } else {
+                    keymapping.setKeyModifierAndCode(net.minecraftforge.client.settings.KeyModifier.NONE, InputConstants.getKey(s1));
+                }
             }
         }
+    }
 
+    private void processOptionsEnd(Options.FieldAccess p_168428_) {
         for (SoundSource soundsource : SoundSource.values()) {
             p_168428_.process("soundCategory_" + soundsource.getName(), this.soundSourceVolumes.get(soundsource));
         }
@@ -1313,6 +_,10 @@
     }
 
     public void load() {
+        load(false);
+    }
+
+    public void load(boolean limited) {
         try {
             if (!this.optionsFile.exists()) {
                 return;
@@ -1337,7 +_,8 @@
                 this.graphicsMode.set(isTrue(optional.get()) ? GraphicsStatus.FANCY : GraphicsStatus.FAST);
             }
 
-            this.processOptions(
+            java.util.function.Consumer<FieldAccess> processor = limited ? this::processOptionsKeysOnly : this::processOptions;
+            processor.accept(
                 new Options.FieldAccess() {
                     @Nullable
                     private String getValue(String p_394210_) {
@@ -1418,6 +_,17 @@
             );
             compoundtag1.getString("fullscreenResolution").ifPresent(p_389133_ -> this.fullscreenVideoModeString = p_389133_);
             KeyMapping.resetMapping();
+
+            if (limited) {
+                this.unknownKeys.clear();
+            } else {
+                var knownKeys = Arrays.stream(this.keyMappings).map(k -> "key_" + k.getName()).collect(Collectors.toSet());
+                for (var entry : compoundtag1.entrySet()) {
+                    if (entry.getKey().startsWith("key_") && entry.getValue().asString().isPresent() && !knownKeys.contains(entry.getKey()))
+                        this.unknownKeys.put(entry.getKey(), entry.getValue().asString().get());
+                }
+            }
+
         } catch (Exception exception) {
             LOGGER.error("Failed to load options", (Throwable)exception);
         }
@@ -1445,9 +_,11 @@
     public void save() {
         try (final PrintWriter printwriter = new PrintWriter(new OutputStreamWriter(new FileOutputStream(this.optionsFile), StandardCharsets.UTF_8))) {
             printwriter.println("version:" + SharedConstants.getCurrentVersion().dataVersion().version());
+            var seen = new java.util.HashSet<String>();
             this.processOptions(
                 new Options.FieldAccess() {
                     public void writePrefix(String p_168491_) {
+                        seen.add(p_168491_);
                         printwriter.print(p_168491_);
                         printwriter.print(':');
                     }
@@ -1503,6 +_,12 @@
             if (s != null) {
                 printwriter.println("fullscreenResolution:" + s);
             }
+            // Forge add any unknown keys so that Mods can add keybindings between vanilla loading/saving its config.
+            for (var entry : this.unknownKeys.entrySet()) {
+                if (!seen.contains(entry.getKey()))
+                    printwriter.println(entry.getKey() + ":" + entry.getValue());
+            }
+
         } catch (Exception exception) {
             LOGGER.error("Failed to save options", (Throwable)exception);
         }
@@ -1541,6 +_,7 @@
     }
 
     public void broadcastOptions() {
+        if (net.minecraftforge.client.loading.ClientModLoader.isLoading()) return; //Don't save settings before mods add keybindigns and the like to prevent them from being deleted.
         if (this.minecraft.player != null) {
             this.minecraft.player.connection.broadcastClientInformation(this.buildPlayerInformation());
         }
@@ -1654,6 +_,23 @@
 
     public static Component genericValueLabel(Component p_231901_, int p_231902_) {
         return genericValueLabel(p_231901_, Component.literal(Integer.toString(p_231902_)));
+    }
+
+    private void setForgeKeybindProperties() {
+        var inGame = net.minecraftforge.client.settings.KeyConflictContext.IN_GAME;
+        keyUp.setKeyConflictContext(inGame);
+        keyLeft.setKeyConflictContext(inGame);
+        keyDown.setKeyConflictContext(inGame);
+        keyRight.setKeyConflictContext(inGame);
+        keyJump.setKeyConflictContext(inGame);
+        keyShift.setKeyConflictContext(inGame);
+        keySprint.setKeyConflictContext(inGame);
+        keyAttack.setKeyConflictContext(inGame);
+        keyChat.setKeyConflictContext(inGame);
+        keyPlayerList.setKeyConflictContext(inGame);
+        keyCommand.setKeyConflictContext(inGame);
+        keyTogglePerspective.setKeyConflictContext(inGame);
+        keySmoothCamera.setKeyConflictContext(inGame);
     }
 
     public static Component genericValueOrOffLabel(Component p_345288_, int p_344826_) {
